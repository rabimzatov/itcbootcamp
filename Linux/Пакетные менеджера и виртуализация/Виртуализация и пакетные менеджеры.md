# Виртуализация

---

## **1. Определение**

**Виртуализация** — это технология, позволяющая создать виртуальную (логическую) версию аппаратных ресурсов: процессоров, памяти, сетевых интерфейсов, хранилищ и т. д.

Эти ресурсы работают так, как если бы это было отдельное физическое устройство, хотя фактически они разделяют одно и то же "железо".

Примеры:

- Запуск Windows и Linux одновременно на одном сервере.
- Создание нескольких веб-серверов внутри одной физической машины.

---

## **2. Ключевая идея**

- Есть **физический сервер** с набором ресурсов: CPU, RAM, диск, сеть.
- Программный слой (гипервизор) "делит" эти ресурсы между несколькими **виртуальными машинами** (ВМ).
- Каждая ВМ работает как отдельный компьютер: у неё своя ОС, свои программы, свои настройки.

---

## **3. Зачем нужна виртуализация**

### **3.1 Экономия ресурсов**

- Раньше: 1 сервер = 1 приложение. Для нового приложения — новый сервер.
- С виртуализацией: можно запускать несколько приложений/ОС на одном физическом сервере, используя его ресурсы эффективнее.
- Пример: сервер с 32 ГБ RAM может хостить 4 ВМ по 8 ГБ вместо 4 физических машин.

**Реальный кейс для DevOps:**

Вместо покупки 10 физических серверов для тестовой среды, можно создать 10 ВМ на одном мощном сервере или в облаке.

---

### **3.2 Изоляция окружений**

- ВМ не влияют друг на друга: сбой в одной не "ломает" другие.
- Можно использовать разные ОС и версии ПО параллельно.
- Повышает безопасность: взлом одной ВМ не даёт доступ к остальным (если нет уязвимостей гипервизора).

**Пример для DevOps:**

У вас есть приложение для Linux и отдельный проект на Windows. Оба окружения можно держать на одном сервере, но в изоляции.

---

### **3.3 Упрощение тестирования и миграций**

- Можно быстро клонировать ВМ для тестов.
- Легко переносить ВМ между серверами (особенно в облаке) без переустановки ОС и ПО.
- Возможность делать "снимки" состояния системы (snapshots) для отката.

**Пример:**

Перед обновлением базы данных DevOps-инженер делает snapshot ВМ. Если обновление сломается, можно за 1–2 минуты вернуть систему в исходное состояние.

---

### **3.4 Гибкость масштабирования**

- Легко добавить новые ВМ или увеличить ресурсы существующих (CPU, RAM, диск).
- Возможность автоматического масштабирования (особенно в облаке).
- Быстрое развёртывание новых окружений.

**Пример:**

При росте нагрузки на сайт DevOps может за несколько минут поднять дополнительные ВМ с балансировкой нагрузки.

---

## **4. Почему это важно для DevOps**

- Позволяет работать с несколькими окружениями на одном физическом сервере.
- Упрощает CI/CD: можно выделить отдельные ВМ под тесты, интеграцию, предпрод.
- Легко воспроизводить окружения для отладки.
- Уменьшает стоимость инфраструктуры.

---

---

## **1. Аппаратная виртуализация (полная, full virtualization)**

**Суть:**

- Гипервизор полностью эмулирует физический компьютер (CPU, память, сеть, диски).
- Гостевая ОС (Guest OS) **не знает**, что она работает в виртуальной среде.
- Для неё всё выглядит как отдельное железо.

**Как работает:**

- Гипервизор (обычно **тип 1**, bare-metal) работает напрямую на сервере без промежуточной ОС.
- Используются аппаратные расширения процессоров (Intel VT-x, AMD-V) для ускорения работы.
- Можно запускать разные ОС на одном сервере (Windows, Linux, BSD и т.д.).

**Плюсы:**

- Полная изоляция гостевых ОС.
- Возможность запускать абсолютно разные ОС.
- Высокая совместимость — гостевая ОС "не догадывается" о виртуализации.

**Минусы:**

- Выше нагрузка на CPU и RAM по сравнению с контейнерами.
- Медленнее старт и выше потребление ресурсов.

**Примеры:**

- **Hyper-V** (Microsoft)
- **VMware ESXi** (корпоративный стандарт у многих компаний)
- **VirtualBox** (настольная разработка и тестирование)

**Зачем DevOps:**

- Полная среда для тестирования приложений, в том числе под другие ОС.
- Лаборатории и учебные среды.
- Продакшн-окружения, где важна изоляция и разные ОС.

---

## **2. Паравиртуализация (paravirtualization)**

**Суть:**

- Гостевая ОС **знает**, что она виртуальная, и взаимодействует с гипервизором напрямую через специальные драйверы и API.
- Вместо полной эмуляции железа часть вызовов аппаратных ресурсов идёт напрямую через гипервизор.

**Как работает:**

- ОС модифицируется (или в неё добавляются специальные драйверы, например VirtIO).
- За счёт этого снижается overhead (затраты на виртуализацию) и повышается производительность.

**Плюсы:**

- Быстрее, чем полная виртуализация.
- Меньше потребление ресурсов.

**Минусы:**

- Требуется модифицированная гостевая ОС.
- Не всегда можно запустить "как есть" любую ОС.

**Примеры:**

- **Xen** (Amazon EC2 раньше использовал паравиртуализацию, сейчас в основном HVM)
- **KVM** (поддержка VirtIO)
- VMware с установкой гостевых дополнений (VMware Tools)

**Зачем DevOps:**

- Для высоконагруженных сервисов, где важна производительность.
- Там, где у нас полный контроль над гостевой ОС.

---

## **3. Виртуализация на уровне ОС (OS-level virtualization)**

**Суть:**

- Нет гипервизора в привычном виде.
- Есть одна ядро хостовой ОС, в котором создаются изолированные пространства (namespaces, cgroups в Linux).
- Гостевые "окружения" используют одно и то же ядро, но у каждого — свои процессы, сеть, файловая система.

**Как работает:**

- Изоляция реализуется средствами ОС.
- Очень быстро и экономно по ресурсам.
- Но все контейнеры должны использовать одно ядро ОС.

**Плюсы:**

- Минимальные накладные расходы.
- Быстрый старт (секунды или меньше).
- Легко масштабировать.

**Минусы:**

- Нельзя запустить ОС с другим ядром. Например, на Linux-хосте нельзя запустить Windows-контейнер без дополнительных технологий.
- Меньше изоляция на уровне безопасности (уязвимости ядра хостовой ОС критичны для всех контейнеров).

**Примеры:**

- **LXC/LXD**
- **Docker**
- **Podman**
- **OpenVZ**

**Зачем DevOps:**

- Запуск микросервисов.
- Быстрое развёртывание тестовых окружений.
- CI/CD пайплайны.
- Масштабирование приложений.

---

## **Сравнение трёх подходов**

| Характеристика | Аппаратная виртуализация | Паравиртуализация | Уровень ОС |
| --- | --- | --- | --- |
| Изоляция | Полная | Почти полная | Средняя |
| Разные ОС внутри | Да | Да | Нет |
| Скорость работы | Низкая–средняя | Средняя–высокая | Высокая |
| Запуск окружения | Минуты | Минуты | Секунды |
| Ресурсоёмкость | Высокая | Средняя | Низкая |
| Примеры | ESXi, Hyper-V, VBox | Xen, KVM, VirtIO | LXC, Docker |

---

---

## **1. Что такое гипервизор**

- **Гипервизор** — это программный или аппаратно-программный слой, который управляет виртуальными машинами (ВМ), распределяя между ними ресурсы физического сервера (CPU, RAM, диск, сеть).
- Он создаёт и поддерживает изоляцию ВМ, чтобы они не мешали друг другу, и даёт каждой виртуальной машине «иллюзию» того, что у неё есть собственный физический компьютер.

**Роль гипервизора для DevOps:**

- Контроль и управление виртуальной инфраструктурой.
- Возможность быстро создавать, удалять и переносить окружения.
- Гибкое масштабирование тестовых и продакшн-систем.

---

## **2. Типы гипервизоров**

### **Тип 1 — Bare-metal (нативный)**

- **Как работает:** устанавливается прямо на физическое железо, без промежуточной хостовой ОС.
- Контролирует доступ ВМ к ресурсам напрямую, через драйверы и аппаратные инструкции процессора.
- Использует аппаратные технологии виртуализации: Intel VT-x, AMD-V.
- Наиболее распространён в дата-центрах и облаках.

**Плюсы:**

- Высокая производительность (меньше накладных расходов).
- Более надёжная изоляция.
- Меньше слоёв → меньше потенциальных уязвимостей.

**Минусы:**

- Требует отдельного сервера под гипервизор.
- Не так просто использовать для локальной разработки (требует отдельного железа или серверных ресурсов).

**Примеры:**

- **VMware ESXi** — корпоративный стандарт для дата-центров.
- **Microsoft Hyper-V (Server Core)** — серверная версия без Windows GUI.
- **KVM (Kernel-based Virtual Machine)** — модуль ядра Linux, фактически превращающий его в гипервизор типа 1.
- **Xen** — часто используется в облаках (AWS EC2 в прошлом, Citrix XenServer).

---

### **Тип 2 — Hosted (гостевой)**

- **Как работает:** устанавливается как обычное приложение на хостовую ОС (Windows, Linux, macOS).
- Гипервизор взаимодействует с оборудованием через драйверы хостовой ОС.
- Используется в основном для разработки, тестов и обучения.

**Плюсы:**

- Легко установить на любой компьютер.
- Можно работать параллельно с основной ОС.
- Удобно для тестовых и учебных задач.

**Минусы:**

- Меньше производительность из-за дополнительного слоя (хостовая ОС).
- Изоляция слабее, чем у типа 1.
- Не оптимален для продакшн-нагрузок.

**Примеры:**

- **Oracle VirtualBox** — бесплатный кроссплатформенный гипервизор.
- **VMware Workstation / VMware Fusion (Mac)** — платные, с улучшенной производительностью и интеграцией.
- **Parallels Desktop** — для запуска Windows на macOS.

---

## **3. Сравнение типа 1 и типа 2**

| Критерий | Тип 1 (Bare-metal) | Тип 2 (Hosted) |
| --- | --- | --- |
| Где работает | Прямо на "железе" | Поверх хостовой ОС |
| Производительность | Высокая | Средняя |
| Изоляция | Максимальная | Хорошая |
| Сценарии использования | Дата-центры, облака | Локальная разработка, тесты |
| Примеры | ESXi, KVM, Xen | VirtualBox, VMware Workstation |

---

## **4. Пример схемы (для слайда)**

**Тип 1 (Bare-metal)**

```
[Аппаратное обеспечение]
        ↓
[Гипервизор (ESXi, KVM)]
        ↓
[ВМ 1]  [ВМ 2]  [ВМ 3]

```

**Тип 2 (Hosted)**

```
[Аппаратное обеспечение]
        ↓
[Хостовая ОС (Windows/Linux/macOS)]
        ↓
[Гипервизор (VirtualBox, VMware Workstation)]
        ↓
[ВМ 1]  [ВМ 2]

```

---

## **5. Почему DevOps важно знать разницу**

- **В продакшене** чаще всего используется тип 1 (в облаках — AWS, GCP, Azure).
- **Для локальной разработки** и обучения — тип 2 (VirtualBox, VMware Workstation).
- Понимание архитектуры помогает оптимально выбирать инструменты и предсказывать их ограничения.

---

---

## **1. Плюсы виртуальных машин**

### **1.1 Полная изоляция**

- Каждая ВМ имеет свой набор ресурсов: виртуальный CPU, оперативную память, диски, сетевые адаптеры.
- ОС и приложения в одной ВМ не могут напрямую влиять на процессы и данные другой (при правильной настройке гипервизора).
- Если внутри ВМ происходит сбой или заражение вирусом, это обычно не затрагивает другие ВМ и хостовую систему.
- Подходит для безопасного тестирования подозрительного ПО или обновлений.

**Пример для DevOps:**

Можно поднять тестовую ВМ с нестабильной версией приложения, не рискуя рабочими системами.

---

### **1.2 Возможность запускать разные ОС**

- На одном физическом сервере можно одновременно работать с Windows, Linux, BSD, даже macOS (при поддержке лицензий и гипервизора).
- Удобно для кроссплатформенной разработки и тестирования.
- Нет привязки к типу хостовой ОС.

**Пример:**

Разработчики пишут приложение под Linux, а тестировщики проверяют его работу в Windows и macOS на том же сервере.

---

### **1.3 Гибкость в настройке «железа»**

- Легко выделить нужное количество CPU, RAM, диска для каждой ВМ.
- Можно менять конфигурацию без замены реального оборудования.
- Можно подключать виртуальные или физические устройства (USB, GPU, диски).

**Пример:**

Для теста высокой нагрузки DevOps может временно увеличить ВМ с 2 до 8 виртуальных CPU.

---

## **2. Минусы виртуальных машин**

### **2.1 Большой overhead (ресурсы)**

- Гипервизор тратит часть ресурсов на управление виртуализацией.
- Каждая ВМ имеет **полную копию ОС** со своими процессами, службами и ядром, что увеличивает нагрузку на CPU и RAM.
- Для эффективной работы часто требуется больше «железа», чем при использовании контейнеров.

**Пример:**

Если поднять 10 ВМ с Linux по 1 ГБ RAM, то минимум 10 ГБ уйдёт только под их ОС, без учёта приложений.

---

### **2.2 Медленный старт**

- Запуск ВМ — это фактически запуск полноценного компьютера: загрузка BIOS, ядра ОС, всех сервисов.
- Может занимать десятки секунд или даже минуты.
- Для динамического масштабирования это недостаток.

**Пример:**

При резком росте трафика на сайт добавление новых ВМ займёт дольше, чем разворачивание контейнеров.

---

### **2.3 Образы занимают много места**

- Диск ВМ содержит всю ОС, драйверы, временные файлы.
- Даже минимальная ОС (например, Ubuntu Server) может занимать гигабайты.
- При создании нескольких клонов ВМ место на хранилище быстро заканчивается.

**Пример:**

10 ВМ с Windows Server могут занять сотни гигабайт только под системные файлы.

---

## **3. Выводы для DevOps**

- **Когда использовать ВМ:**
    - Нужна полная изоляция и безопасность.
    - Требуется работать с разными ОС.
    - Важна возможность гибко управлять виртуальным оборудованием.
- **Когда рассмотреть альтернативу (контейнеры):**
    - Нужен быстрый старт.
    - Ограничены ресурсы.
    - Все приложения могут работать на одном ядре ОС.

---

---

## **1. Определение**

- **Контейнеризация** — способ упаковать приложение вместе с его зависимостями (библиотеками, конфигурацией, окружением) в единый изолированный контейнер.
- Контейнер запускается поверх хостовой ОС, но изолирован от других контейнеров и основной системы.
- Основная задача — обеспечить одинаковую работу приложения в любой среде: на локальном компьютере, в тестовой или в продакшн-системе.

---

## **2. Чем отличается от виртуальной машины**

### **2.1 Общие ресурсы**

- Контейнер **не эмулирует весь компьютер**.
- Все контейнеры используют **одно ядро хостовой ОС**, но у каждого свой файловый, сетевой и процессный пространства.
- Нет отдельной гостевой ОС, что сокращает накладные расходы.

### **2.2 Легче и быстрее**

- Нет необходимости загружать отдельную ОС — контейнер стартует за доли секунды.
- Процесс запуска похож на запуск обычного приложения.

### **2.3 Меньше потребление ресурсов**

- За счёт отсутствия гостевой ОС контейнеры используют меньше CPU, RAM и диска.
- Можно запускать десятки или сотни контейнеров там, где уместилось бы лишь несколько ВМ.

---

## **3. Пример для наглядности**

- **Виртуальная машина** — это отдельный компьютер внутри компьютера (с собственной ОС).
- **Контейнер** — это приложение в «песочнице», использующее ядро хостовой системы.

---

## **4. Для чего это важно знать DevOps уже сейчас**

- Даже если Docker и Kubernetes будут позже, важно понимать, что контейнеры — это **более лёгкий и быстрый способ изоляции приложений**, чем ВМ.
- Это помогает при выборе инструментов: ВМ — для полной изоляции и разных ОС, контейнеры — для быстрых и лёгких развёртываний в рамках одной ОС.

---

---

## **1. Быстрая доставка приложений**

- Контейнеры можно запускать и останавливать за секунды.
- Разработчик упаковывает приложение один раз, и его можно сразу запускать на любой машине с поддержкой контейнеров.
- Нет долгих установок зависимостей на сервере — всё уже внутри контейнера.
- Это сокращает время между написанием кода и его публикацией в тестовую или боевую среду.

**Пример:**

Разработчик подготовил образ контейнера с новой версией веб-приложения, DevOps просто запускает его на сервере — приложение готово без дополнительной настройки.

---

## **2. Предсказуемое окружение**

- Контейнер содержит все зависимости, конфигурацию и библиотеки, нужные для работы приложения.
- Неважно, где контейнер запускается — на ноутбуке разработчика, тестовом сервере или в облаке, результат будет одинаковым.
- Устраняет проблему «у меня работает, а у вас нет» (разные версии библиотек, разные настройки ОС).

**Пример:**

Если приложение требует Python 3.9 и определённые версии пакетов, контейнер уже включает это, и DevOps не тратит время на настройку серверов.

---

## **3. Масштабируемость**

- Легко запускать несколько копий одного и того же контейнера для распределения нагрузки.
- Можно быстро добавлять или убирать контейнеры в зависимости от трафика и нагрузки.
- Хорошо сочетается с облаком, где можно поднимать ресурсы «по требованию».

**Пример:**

При росте количества пользователей DevOps запускает дополнительные контейнеры с приложением за секунды, чтобы избежать перегрузки.

---

## **4. Интеграция с CI/CD**

- Контейнеры легко включаются в автоматические конвейеры сборки, тестирования и доставки.
- Можно автоматически собирать новый образ контейнера при изменении кода и разворачивать его на сервере без ручных действий.
- Обеспечивает повторяемость и надёжность релизов.

**Пример:**

Каждый коммит в Git запускает сборку контейнера в CI-системе, проходит тесты, и готовый образ автоматически деплоится на staging-сервер.

---

## **5. Вывод для DevOps**

- Контейнеры позволяют быстро и одинаково запускать приложения в разных средах.
- Они упрощают масштабирование и автоматизацию.
- В перспективе это основной инструмент для CI/CD и современных DevOps-процессов.

---

---

## **1. Определение**

- **Пакетный менеджер** — это программа, которая автоматизирует:
    - установку,
    - обновление,
    - удаление программного обеспечения.
- Вместо скачивания и установки ПО вручную, пакетный менеджер:
    1. Находит нужный пакет в репозитории.
    2. Загружает его.
    3. Устанавливает вместе со всеми зависимостями.
    4. Ведёт учёт установленных пакетов и версий.
- Работает через **командную строку** или графический интерфейс (реже в DevOps используется GUI).

---

## **2. Зачем нужен**

### **2.1 Автоматизация установки зависимостей**

- Если приложение требует десятки библиотек, пакетный менеджер установит их автоматически.
- Избавляет от необходимости вручную искать и скачивать каждую зависимость.

**Пример:**

Команда `apt install nginx` на Ubuntu установит:

- сам Nginx,
- все необходимые пакеты для его работы.

---

### **2.2 Удобное обновление**

- Обновление всех пакетов в системе одной командой (`apt upgrade`, `yum update`).
- Поддержка системы в актуальном и безопасном состоянии.

---

### **2.3 Удаление и управление версиями**

- Легко удалить пакет вместе с ненужными зависимостями (`apt remove`, `dnf remove`).
- Часто есть возможность установить конкретную версию пакета (полезно при тестировании или откате).

---

## **3. Примеры пакетных менеджеров**

### **Linux**

- **apt** (Debian, Ubuntu и производные).
- **yum** (устаревший в RHEL/CentOS).
- **dnf** (замена yum в новых RHEL/CentOS/Fedora).

### **macOS**

- **brew** (Homebrew) — популярный кроссплатформенный менеджер пакетов.

### **Windows**

- **choco** (Chocolatey) — установка ПО через PowerShell.
- **winget** — официальный менеджер пакетов от Microsoft.

---

## **4. Почему DevOps важно это знать**

- DevOps часто автоматизирует развёртывание окружений, и пакетные менеджеры — основной инструмент для этого.
- В конфигурационных скриптах (Ansible, Terraform, shell-скриптах) команды установки пакетов используются постоянно.
- Без понимания работы пакетных менеджеров нельзя эффективно работать с серверами в Linux, Windows и macOS.

---